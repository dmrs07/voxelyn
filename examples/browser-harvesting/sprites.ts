// sprites.ts - Cute chibi pixel art for the harvesting game
// All sprites use indexed colors referencing PALETTE

import { packRGBA } from "../../packages/voxelyn-core/src/index.js";

// ============================================================================
// COLOR PALETTE - Warm, cozy farm colors
// ============================================================================
export const PALETTE: number[] = [
  packRGBA(0, 0, 0, 0),         // 0 - transparent
  packRGBA(35, 25, 20, 255),    // 1 - dark outline
  packRGBA(92, 64, 51, 255),    // 2 - brown (dirt)
  packRGBA(139, 90, 43, 255),   // 3 - light brown (tilled)
  packRGBA(82, 145, 78, 255),   // 4 - grass green
  packRGBA(110, 170, 90, 255),  // 5 - light grass
  packRGBA(194, 156, 76, 255),  // 6 - wheat gold
  packRGBA(230, 195, 110, 255), // 7 - light wheat
  packRGBA(64, 128, 180, 255),  // 8 - water blue
  packRGBA(100, 160, 210, 255), // 9 - light water
  packRGBA(255, 220, 177, 255), // 10 - skin tone
  packRGBA(255, 195, 150, 255), // 11 - skin shadow
  packRGBA(120, 80, 60, 255),   // 12 - hair brown
  packRGBA(85, 55, 40, 255),    // 13 - hair dark
  packRGBA(255, 100, 120, 255), // 14 - cheek blush
  packRGBA(40, 40, 50, 255),    // 15 - eyes
  packRGBA(255, 255, 255, 255), // 16 - white/highlight
  packRGBA(200, 120, 80, 255),  // 17 - overalls orange
  packRGBA(170, 95, 60, 255),   // 18 - overalls shadow
  packRGBA(100, 180, 220, 255), // 19 - shirt blue
  packRGBA(70, 140, 180, 255),  // 20 - shirt shadow
  packRGBA(90, 70, 50, 255),    // 21 - tool handle
  packRGBA(150, 150, 160, 255), // 22 - tool metal
  packRGBA(60, 100, 50, 255),   // 23 - dark green (stems)
  packRGBA(255, 240, 200, 255), // 24 - cream (seeds)
  packRGBA(220, 100, 100, 255), // 25 - red (particles)
  packRGBA(255, 220, 100, 255), // 26 - yellow (particles)
  packRGBA(100, 200, 255, 255), // 27 - cyan (water drops)
];

// ============================================================================
// SPRITE TYPE - indexed 16x16 frames
// ============================================================================
export type SpriteFrame = Uint8Array; // 16x16 = 256 palette indices
export type SpriteAnim = SpriteFrame[];
export type DirectionalAnim = { dr: SpriteAnim; dl: SpriteAnim; ur: SpriteAnim; ul: SpriteAnim };

// Helper to create mirrored frames (flip horizontally)
function mirrorFrame(frame: Uint8Array, size = 16): Uint8Array {
  const mirrored = new Uint8Array(size * size);
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      mirrored[y * size + x] = frame[y * size + (size - 1 - x)]!;
    }
  }
  return mirrored;
}

// ============================================================================
// CHIBI FARMER SPRITES (16x16)
// Cute proportions: big head, small body, expressive
// ============================================================================

// Idle facing down-right (main direction)
const FARMER_IDLE_DR_1 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,12,13,13,12,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,12,13,13,13,13,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,10,10,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,15,16,10,10,15,16,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,14,14,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 0, 1,10,10,10,10,10,10, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,19,19,19,19, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,18, 1, 1,18,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,18, 1, 1,18, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 2, 1, 1, 2, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Idle frame 2 - slight bob
const FARMER_IDLE_DR_2 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,12,13,13,12,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,12,13,13,13,13,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,10,10,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,15,16,10,10,15,16,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,14,14,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 0, 1,10,10,10,10,10,10, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,19,19,19,19, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,18, 1, 1,18,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,18, 1, 1,18, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 2, 1, 1, 2, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,
]);

// Walk frames - legs moving
const FARMER_WALK_DR_1 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,12,13,13,12,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,12,13,13,13,13,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,10,10,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,15,16,10,10,15,16,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,14,14,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 0, 1,10,10,10,10,10,10, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,19,19,19,19, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,18, 1, 1,18,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18, 1, 0, 0, 1,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 2, 1, 0, 0, 0, 1, 2, 1, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

const FARMER_WALK_DR_2 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,12,13,13,12,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,12,13,13,13,13,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,10,10,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,15,16,10,10,15,16,10, 1, 0, 0, 0,
  0, 0, 0, 1,10,10,10,14,14,10,10,10, 1, 0, 0, 0,
  0, 0, 0, 0, 1,10,10,10,10,10,10, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,19,19,19,19, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,17,17,17,17,17, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,17,18, 1, 1,18,17, 1, 0, 0, 0, 0,
  0, 0, 0, 1,18, 1, 0, 0, 0, 1,18, 1, 0, 0, 0, 0,
  0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 1, 2, 1, 0, 0, 0,
  0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Up-right facing (back view)
const FARMER_IDLE_UR_1 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,13,13,13,13,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,12,12,12,12,12,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,11,11,11,11,11,11,11,11, 1, 0, 0, 0,
  0, 0, 0, 0, 1,11,11,11,11,11,11, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,20,20,20,20, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18, 1, 1,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,18, 1, 1,18, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 2, 1, 1, 2, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

const FARMER_WALK_UR_1 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,13,13,13,13,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,12,12,12,12,12,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,11,11,11,11,11,11,11,11, 1, 0, 0, 0,
  0, 0, 0, 0, 1,11,11,11,11,11,11, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,20,20,20,20, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18, 1, 1,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18, 1, 0, 0, 1,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 2, 1, 0, 0, 0, 1, 2, 1, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

const FARMER_WALK_UR_2 = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,12,12,12,12, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,12,13,13,13,13,12, 1, 0, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,13,13,13,13,13,13,12, 1, 0, 0, 0,
  0, 0, 0, 1,12,12,12,12,12,12,12,12, 1, 0, 0, 0,
  0, 0, 0, 1,11,11,11,11,11,11,11,11, 1, 0, 0, 0,
  0, 0, 0, 0, 1,11,11,11,11,11,11, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1,20,20,20,20, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18,18,18,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1,18,18, 1, 1,18,18, 1, 0, 0, 0, 0,
  0, 0, 0, 1,18, 1, 0, 0, 0, 1,18, 1, 0, 0, 0, 0,
  0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 1, 2, 1, 0, 0, 0,
  0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Build directional animations (mirror for opposite directions)
export const FARMER_SPRITES: { idle: DirectionalAnim; walk: DirectionalAnim } = {
  idle: {
    dr: [FARMER_IDLE_DR_1, FARMER_IDLE_DR_2],
    dl: [mirrorFrame(FARMER_IDLE_DR_1), mirrorFrame(FARMER_IDLE_DR_2)],
    ur: [FARMER_IDLE_UR_1, FARMER_IDLE_UR_1],
    ul: [mirrorFrame(FARMER_IDLE_UR_1), mirrorFrame(FARMER_IDLE_UR_1)],
  },
  walk: {
    dr: [FARMER_WALK_DR_1, FARMER_WALK_DR_2],
    dl: [mirrorFrame(FARMER_WALK_DR_1), mirrorFrame(FARMER_WALK_DR_2)],
    ur: [FARMER_WALK_UR_1, FARMER_WALK_UR_2],
    ul: [mirrorFrame(FARMER_WALK_UR_1), mirrorFrame(FARMER_WALK_UR_2)],
  },
};

// ============================================================================
// WHEAT CROP SPRITES (16x16, 4 growth stages)
// ============================================================================

// Stage 0: Seeds (just planted)
const WHEAT_SEED = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0,24, 0, 0, 0, 0,24, 0, 0, 0, 0, 0,
  0, 0, 0, 0,24, 0, 0,24, 0, 0, 0,24, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Stage 1: Sprout (tiny green shoots)
const WHEAT_SPROUT = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0,23, 0, 5, 0, 0,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5,23, 0,23, 0, 5,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23, 0,23, 5,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Stage 2: Growing (taller green stalks)
const WHEAT_GROWING = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 4, 5, 0, 5, 4, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23, 4,23, 0,23, 4,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23, 4,23, 5,23, 4,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23, 4,23,23,23, 4,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

// Stage 3: Mature (golden wheat heads)
const WHEAT_MATURE = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 7, 6, 7, 0, 7, 6, 7, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 6, 6, 6, 7, 6, 6, 6, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 7, 6, 7, 6, 7, 6, 7, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 6, 6, 6, 7, 6, 6, 6, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23, 6,23, 6,23, 6,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0,23,23,23,23,23,23,23, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]);

export const WHEAT_STAGES: SpriteFrame[] = [WHEAT_SEED, WHEAT_SPROUT, WHEAT_GROWING, WHEAT_MATURE];

// ============================================================================
// ISOMETRIC TILE SPRITES (32x16)
// ============================================================================

function makeIsoTile(baseColor: number, accentColor: number, variation = 0): Uint32Array {
  const w = 32, h = 16;
  const px = new Uint32Array(w * h);
  const hw = w / 2, hh = h / 2;
  const base = PALETTE[baseColor]!;
  const accent = PALETTE[accentColor]!;
  const outline = PALETTE[1]!;

  for (let y = 0; y < h; y++) {
    for (let x = 0; x < w; x++) {
      const dx = Math.abs(x - hw) / hw;
      const dy = Math.abs(y - hh) / hh;
      if (dx + dy <= 1) {
        // Inside diamond
        const edge = dx + dy > 0.85;
        const isAccent = ((x + y + variation) % 7 === 0) && !edge;
        px[y * w + x] = edge ? outline : (isAccent ? accent : base);
      }
    }
  }
  return px;
}

export const TILE_GRASS = { width: 32, height: 16, pixels: makeIsoTile(4, 5, 0) };
export const TILE_TILLED = { width: 32, height: 16, pixels: makeIsoTile(2, 3, 3) };
export const TILE_WATERED = { width: 32, height: 16, pixels: makeIsoTile(8, 9, 5) };

// ============================================================================
// TOOL ICONS (8x8 for HUD)
// ============================================================================
const ICON_HOE = new Uint8Array([
  0, 0, 0,22,22, 0, 0, 0,
  0, 0,22,22, 0, 0, 0, 0,
  0,22,22, 0, 0, 0, 0, 0,
  21,21, 0, 0, 0, 0, 0, 0,
  21,21, 0, 0, 0, 0, 0, 0,
  0,21,21, 0, 0, 0, 0, 0,
  0, 0,21,21, 0, 0, 0, 0,
  0, 0, 0,21, 0, 0, 0, 0,
]);

const ICON_WATER = new Uint8Array([
  0, 0, 8, 8, 8, 0, 0, 0,
  0, 8, 9, 9, 8, 8, 0, 0,
  8, 9, 8, 8, 9, 8, 8, 0,
  8, 8,21,21,21, 8, 8, 0,
  8,21,21,21,21,21, 8, 0,
  8,21,21,21,21,21, 8, 0,
  0, 8,21,21,21, 8, 0, 0,
  0, 0, 8, 8, 8, 0, 0, 0,
]);

const ICON_SEEDS = new Uint8Array([
  0, 0, 0, 0, 0, 0, 0, 0,
  0, 6, 0, 6, 0, 6, 0, 0,
  0, 0, 6, 0, 6, 0, 0, 0,
  0, 6, 0, 6, 0, 6, 0, 0,
  0, 0, 6, 0, 6, 0, 0, 0,
  0, 6, 0, 6, 0, 6, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0,
]);

export const TOOL_ICONS: Record<string, { data: Uint8Array; size: number }> = {
  hoe: { data: ICON_HOE, size: 8 },
  water: { data: ICON_WATER, size: 8 },
  seeds: { data: ICON_SEEDS, size: 8 },
};

// ============================================================================
// PARTICLE SYSTEM
// ============================================================================
export type Particle = {
  x: number;
  y: number;
  vx: number;
  vy: number;
  life: number;
  maxLife: number;
  color: number; // packed RGBA
};

export const particles: Particle[] = [];

export function spawnParticle(x: number, y: number, colorIndex: number, speed = 1, life = 30): void {
  particles.push({
    x,
    y,
    vx: (Math.random() - 0.5) * speed * 2,
    vy: -Math.random() * speed - 0.5,
    life,
    maxLife: life,
    color: PALETTE[colorIndex]!,
  });
}

export function spawnBurst(x: number, y: number, colorIndex: number, count = 5): void {
  for (let i = 0; i < count; i++) {
    spawnParticle(x + Math.random() * 8 - 4, y + Math.random() * 4 - 2, colorIndex, 1.5, 25 + Math.random() * 15);
  }
}

export function updateParticles(): void {
  for (const p of particles) {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.08; // gravity
    p.life--;
  }
  // Remove dead particles
  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i]!.life <= 0) particles.splice(i, 1);
  }
}
